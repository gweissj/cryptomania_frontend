import '/app_components/chip/chip_widget.dart';
import '/app_components/crypto_tile/crypto_tile_widget.dart';
import '/app_components/custom_button/custom_button_widget.dart';
import '/app_components/custom_title_appbar/custom_title_appbar_widget.dart';
import '/app_components/customized_tab_bar/customized_tab_bar_widget.dart';
import '/app_components/trade_list/trade_list_widget.dart';
import '/features/trade/components/trade_bottom_button_content/trade_bottom_button_content_widget.dart';
import '/flutter_flow/flutter_flow_theme.dart';
import '/flutter_flow/flutter_flow_util.dart';
import '/flutter_flow/flutter_flow_widgets.dart';
import 'dart:ui';
import '/custom_code/widgets/index.dart' as custom_widgets;
import 'package:flutter/material.dart';
import 'package:font_awesome_flutter/font_awesome_flutter.dart';
import 'package:google_fonts/google_fonts.dart';
import 'package:provider/provider.dart';

import 'trading_page_model.dart';
export 'trading_page_model.dart';

class TradingPageWidget extends StatefulWidget {
  const TradingPageWidget({super.key});

  static String routeName = 'trading_page';
  static String routePath = '/tradingPage';

  @override
  State<TradingPageWidget> createState() => _TradingPageWidgetState();
}

class _TradingPageWidgetState extends State<TradingPageWidget> {
  late TradingPageModel _model;

  final scaffoldKey = GlobalKey<ScaffoldState>();

  @override
  void initState() {
    super.initState();
    _model = createModel(context, () => TradingPageModel());
  }

  @override
  void dispose() {
    _model.dispose();

    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    context.watch<FFAppState>();

    return GestureDetector(
      onTap: () {
        FocusScope.of(context).unfocus();
        FocusManager.instance.primaryFocus?.unfocus();
      },
      child: Scaffold(
        key: scaffoldKey,
        backgroundColor: FlutterFlowTheme.of(context).primaryBackground,
        appBar: AppBar(
          backgroundColor: FlutterFlowTheme.of(context).primaryBackground,
          automaticallyImplyLeading: false,
          actions: [],
          flexibleSpace: FlexibleSpaceBar(
            title: wrapWithModel(
              model: _model.customTitleAppbarModel,
              updateCallback: () => safeSetState(() {}),
              child: CustomTitleAppbarWidget(
                title: 'Trading',
                leadingIcon: Icon(
                  Icons.arrow_back_ios,
                  color: FlutterFlowTheme.of(context).grey,
                  size: 20,
                ),
                trailingIcon: FaIcon(
                  FontAwesomeIcons.clipboard,
                ),
                showLeading: true,
                showTrailing: true,
              ),
            ),
            centerTitle: true,
            expandedTitleScale: 1.0,
          ),
          elevation: 2,
        ),
        body: SafeArea(
          top: true,
          child: Column(
            mainAxisSize: MainAxisSize.max,
            children: [
              Expanded(
                child: Padding(
                  padding: EdgeInsetsDirectional.fromSTEB(10, 10, 20, 0),
                  child: SingleChildScrollView(
                    child: Column(
                      mainAxisSize: MainAxisSize.max,
                      children: [
                        wrapWithModel(
                          model: _model.tabBarModel,
                          updateCallback: () => safeSetState(() {}),
                          updateOnChange: true,
                          child: CustomizedTabBarWidget(
                            inactiveTrackColor: (Theme.of(context).brightness ==
                                        Brightness.dark) ==
                                    true
                                ? FlutterFlowTheme.of(context).alternate
                                : FlutterFlowTheme.of(context).disable,
                            activeChipColor: FlutterFlowTheme.of(context)
                                .secondaryBackground,
                            tabList: _model.timebarList,
                          ),
                        ),
                        Container(
                          width: double.infinity,
                          height: MediaQuery.sizeOf(context).height * 0.28,
                          decoration: BoxDecoration(
                            color: FlutterFlowTheme.of(context)
                                .secondaryBackground,
                            borderRadius: BorderRadius.only(
                              bottomLeft: Radius.circular(12),
                              bottomRight: Radius.circular(12),
                              topLeft: Radius.circular(12),
                              topRight: Radius.circular(12),
                            ),
                          ),
                          child: Column(
                            mainAxisSize: MainAxisSize.max,
                            children: [
                              wrapWithModel(
                                model: _model.cryptoTileModel,
                                updateCallback: () => safeSetState(() {}),
                                child: CryptoTileWidget(
                                  title: 'Bitcoin',
                                  subtitle: 'BTC',
                                  trailingTitle: '\$30,113.80',
                                  trailingSubtitle: '+2.76%',
                                  iconPath:
                                      'https://storage.googleapis.com/flutterflow-io-6f20.appspot.com/projects/comoney-ctvxmz/assets/9mol1nva5ge2/bitcoin.svg',
                                  isFilled: false,
                                  elevation: 0.0,
                                ),
                              ),
                              Flexible(
                                child: Padding(
                                  padding: EdgeInsets.all(8),
                                  child: custom_widgets.AreaChart(
                                    width: double.infinity,
                                    height: 50,
                                    chartData: () {
                                      if ((String tab) {
                                        return tab.contains('Hour');
                                      }(_model.tabBarModel.selectedTab!)) {
                                        return FFAppState().dummyGraphData;
                                      } else if ((String tab) {
                                        return tab.contains('Day');
                                      }(_model.tabBarModel.selectedTab!)) {
                                        return FFAppState().dummyGraphDataDay;
                                      } else if ((String tab) {
                                        return tab.contains('Month');
                                      }(_model.tabBarModel.selectedTab!)) {
                                        return FFAppState().dummyGraphDataMonth;
                                      } else {
                                        return FFAppState().dummyGraphDataYear;
                                      }
                                    }(),
                                    splineType: 3,
                                    areaColor:
                                        FlutterFlowTheme.of(context).primary,
                                    xInterval: 6.0,
                                    yInterval: 10000.0,
                                    gradStartAlignment: 0,
                                    gradEndAlignment: 6,
                                    isGradient: true,
                                    borderColor:
                                        FlutterFlowTheme.of(context).primary,
                                    xAxisTitle: '  ',
                                    yAxisTitle: '  ',
                                    xTitleColor: FlutterFlowTheme.of(context)
                                        .primaryText,
                                    xTitleFontSize: 10.0,
                                    yTitleColor: FlutterFlowTheme.of(context)
                                        .primaryText,
                                    yTitleFontSize: 10.0,
                                    maxXAxisLabels: 5,
                                    isYAxisVisible: true,
                                  ),
                                ),
                              ),
                            ],
                          ),
                        ),
                        Column(
                          mainAxisSize: MainAxisSize.max,
                          crossAxisAlignment: CrossAxisAlignment.start,
                          children: [
                            Text(
                              'Popular Pairs',
                              style: FlutterFlowTheme.of(context)
                                  .labelMedium
                                  .override(
                                    font: GoogleFonts.readexPro(
                                      fontWeight: FlutterFlowTheme.of(context)
                                          .labelMedium
                                          .fontWeight,
                                      fontStyle: FlutterFlowTheme.of(context)
                                          .labelMedium
                                          .fontStyle,
                                    ),
                                    color: FlutterFlowTheme.of(context)
                                        .primaryText,
                                    letterSpacing: 0.0,
                                    fontWeight: FlutterFlowTheme.of(context)
                                        .labelMedium
                                        .fontWeight,
                                    fontStyle: FlutterFlowTheme.of(context)
                                        .labelMedium
                                        .fontStyle,
                                  ),
                            ),
                            Builder(
                              builder: (context) {
                                final pairItem = _model.popularPairs.toList();

                                return SingleChildScrollView(
                                  scrollDirection: Axis.horizontal,
                                  child: Row(
                                    mainAxisSize: MainAxisSize.max,
                                    children: List.generate(pairItem.length,
                                        (pairItemIndex) {
                                      final pairItemItem =
                                          pairItem[pairItemIndex];
                                      return wrapWithModel(
                                        model: _model.chipModels.getModel(
                                          pairItemIndex.toString(),
                                          pairItemIndex,
                                        ),
                                        updateCallback: () =>
                                            safeSetState(() {}),
                                        child: ChipWidget(
                                          key: Key(
                                            'Key1sx_${pairItemIndex.toString()}',
                                          ),
                                          title: pairItemItem,
                                          isSelected: pairItemItem ==
                                                  _model.selectedPair
                                              ? true
                                              : false,
                                          onTap: () async {
                                            _model.selectedPair = pairItemItem;
                                            safeSetState(() {});
                                          },
                                        ),
                                      );
                                    }).divide(SizedBox(width: 8)),
                                  ),
                                );
                              },
                            ),
                          ].divide(SizedBox(height: 8)),
                        ),
                        Column(
                          mainAxisSize: MainAxisSize.max,
                          crossAxisAlignment: CrossAxisAlignment.start,
                          children: [
                            Text(
                              'Trading History',
                              style: FlutterFlowTheme.of(context)
                                  .labelMedium
                                  .override(
                                    font: GoogleFonts.readexPro(
                                      fontWeight: FlutterFlowTheme.of(context)
                                          .labelMedium
                                          .fontWeight,
                                      fontStyle: FlutterFlowTheme.of(context)
                                          .labelMedium
                                          .fontStyle,
                                    ),
                                    color: FlutterFlowTheme.of(context)
                                        .primaryText,
                                    letterSpacing: 0.0,
                                    fontWeight: FlutterFlowTheme.of(context)
                                        .labelMedium
                                        .fontWeight,
                                    fontStyle: FlutterFlowTheme.of(context)
                                        .labelMedium
                                        .fontStyle,
                                  ),
                            ),
                            Row(
                              mainAxisSize: MainAxisSize.max,
                              mainAxisAlignment: MainAxisAlignment.center,
                              children: [
                                Expanded(
                                  flex: 1,
                                  child: Container(
                                    width:
                                        MediaQuery.sizeOf(context).width * 0.35,
                                    decoration: BoxDecoration(),
                                    child: wrapWithModel(
                                      model: _model.priceListItemModel,
                                      updateCallback: () => safeSetState(() {}),
                                      child: TradeListWidget(
                                        itemsList: _model.dummyPriceList,
                                        titleText: 'Price',
                                      ),
                                    ),
                                  ),
                                ),
                                Expanded(
                                  flex: 1,
                                  child: Container(
                                    width:
                                        MediaQuery.sizeOf(context).width * 0.35,
                                    decoration: BoxDecoration(),
                                    child: wrapWithModel(
                                      model: _model.amountListItemModel,
                                      updateCallback: () => safeSetState(() {}),
                                      child: TradeListWidget(
                                        itemsList: _model.dummyAmountList,
                                        titleText: 'Amount',
                                      ),
                                    ),
                                  ),
                                ),
                                Expanded(
                                  flex: 1,
                                  child: Container(
                                    width:
                                        MediaQuery.sizeOf(context).width * 0.3,
                                    decoration: BoxDecoration(),
                                    child: wrapWithModel(
                                      model: _model.timeListItemModel,
                                      updateCallback: () => safeSetState(() {}),
                                      child: TradeListWidget(
                                        itemsList: _model.dummyTimeList,
                                        titleText: 'Time',
                                      ),
                                    ),
                                  ),
                                ),
                              ].divide(SizedBox(width: 20)),
                            ),
                          ].divide(SizedBox(height: 15)),
                        ),
                      ].divide(SizedBox(height: 20)),
                    ),
                  ),
                ),
              ),
              Align(
                alignment: AlignmentDirectional(0, 1),
                child: Container(
                  width: double.infinity,
                  height: 100,
                  decoration: BoxDecoration(
                    color: FlutterFlowTheme.of(context).secondaryBackground,
                  ),
                  child: Padding(
                    padding: EdgeInsetsDirectional.fromSTEB(15, 0, 15, 0),
                    child: Row(
                      mainAxisSize: MainAxisSize.max,
                      mainAxisAlignment: MainAxisAlignment.start,
                      children: [
                        Expanded(
                          child: wrapWithModel(
                            model: _model.customButtonModel1,
                            updateCallback: () => safeSetState(() {}),
                            updateOnChange: true,
                            child: CustomButtonWidget(
                              borderColor: FlutterFlowTheme.of(context).primary,
                              height: 50.0,
                              isFilled: false,
                              borderRadius: 12.0,
                              child: () => TradeBottomButtonContentWidget(
                                titleText: 'SELL',
                                imagePath: Theme.of(context).brightness ==
                                        Brightness.dark
                                    ? 'https://storage.googleapis.com/flutterflow-io-6f20.appspot.com/projects/comoney-ctvxmz/assets/q0y4acq53hct/sell.svg'
                                    : 'https://storage.googleapis.com/flutterflow-io-6f20.appspot.com/projects/comoney-ctvxmz/assets/b9egq1ten3je/sell_light.svg',
                                isBefore: true,
                                textColor: valueOrDefault<Color>(
                                  Theme.of(context).brightness ==
                                          Brightness.light
                                      ? FlutterFlowTheme.of(context).primary
                                      : FlutterFlowTheme.of(context).info,
                                  FlutterFlowTheme.of(context).primary,
                                ),
                              ),
                            ),
                          ),
                        ),
                        Expanded(
                          child: wrapWithModel(
                            model: _model.customButtonModel2,
                            updateCallback: () => safeSetState(() {}),
                            updateOnChange: true,
                            child: CustomButtonWidget(
                              fillColor: FlutterFlowTheme.of(context).primary,
                              height: 50.0,
                              isFilled: true,
                              borderRadius: 12.0,
                              child: () => TradeBottomButtonContentWidget(
                                titleText: 'BUY',
                                imagePath:
                                    'https://storage.googleapis.com/flutterflow-io-6f20.appspot.com/projects/comoney-ctvxmz/assets/v63ri7rhhnlm/buy.svg',
                                textColor: FlutterFlowTheme.of(context).info,
                              ),
                            ),
                          ),
                        ),
                      ].divide(SizedBox(width: 20)),
                    ),
                  ),
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
